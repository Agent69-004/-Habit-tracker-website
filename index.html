<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Streak ‚Äî Habit Tracker</title>
<link href="https://fonts.googleapis.com/css2?family=Clash+Display:wght@400;500;600;700&family=Sentient:ital,wght@0,400;0,700;1,400;1,700&family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;1,9..40,300&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#0a0f0a; --s1:#111811; --s2:#172017; --s3:#1e2a1e; --s4:#243024;
  --bd:rgba(255,255,255,0.07); --bd2:rgba(255,255,255,0.13);
  --gold:#f0c040; --gold2:#f7d060; --gold3:#fce090;
  --grn:#2ecc71; --grn2:#27ae60;
  --coral:#ff5a3c; --sky:#5bc8f5; --blush:#f5849a; --amber:#ffa530;
  --txt:#f0ede8; --txt2:#9aaa94; --txt3:#5a6a58; --txt4:#3a4a38;
  --sh:0 4px 24px rgba(0,0,0,.4); --sh2:0 12px 48px rgba(0,0,0,.6);
}
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html{scroll-behavior:smooth}
body{font-family:'DM Sans',sans-serif;background:var(--bg);color:var(--txt);min-height:100vh;overflow-x:hidden}
body::before{content:'';position:fixed;inset:0;pointer-events:none;z-index:0;
  background:radial-gradient(ellipse 60% 40% at 10% 10%,rgba(46,204,113,.06) 0%,transparent 60%),
             radial-gradient(ellipse 50% 50% at 90% 90%,rgba(240,192,64,.05) 0%,transparent 60%)}
body::after{content:'';position:fixed;inset:0;pointer-events:none;z-index:0;opacity:.35;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='250' height='250'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3CfeColorMatrix type='saturate' values='0'/%3E%3C/filter%3E%3Crect width='250' height='250' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E")}

/* VIEWS */
.view{display:none;flex-direction:column;min-height:100vh;position:relative;z-index:1;padding-bottom:90px}
.view.active{display:flex}
#view-stats,#view-history,#view-settings{overflow-y:auto;padding:52px 22px 90px;gap:16px}

/* TOPBAR */
.topbar{display:flex;justify-content:space-between;align-items:center;padding:52px 22px 0;animation:fadeDown .6s ease both}
.logo{font-family:'Clash Display',sans-serif;font-size:22px;font-weight:700;letter-spacing:.06em;color:var(--gold);display:flex;align-items:center;gap:7px}
.logo-pip{width:7px;height:7px;background:var(--coral);border-radius:50%;animation:pip 2.5s ease-in-out infinite}
@keyframes pip{0%,100%{box-shadow:0 0 0 0 rgba(255,90,60,.5)}50%{box-shadow:0 0 0 7px rgba(255,90,60,0)}}
.topbar-right{display:flex;gap:10px}
.icon-btn{width:38px;height:38px;border-radius:12px;background:var(--s2);border:1px solid var(--bd);display:flex;align-items:center;justify-content:center;font-size:17px;cursor:pointer;transition:all .2s ease}
.icon-btn:hover{background:var(--s3);border-color:var(--bd2)}
.icon-btn:active{transform:scale(.93)}

/* GREETING */
.greeting-block{padding:24px 22px 0;animation:fadeDown .6s .08s ease both}
.greeting-eyebrow{font-size:12px;font-weight:500;color:var(--txt3);letter-spacing:.12em;text-transform:uppercase;margin-bottom:6px;display:flex;align-items:center;gap:8px}
.live-dot{width:6px;height:6px;background:var(--grn);border-radius:50%;animation:pip 2s ease-in-out infinite}
.greeting-title{font-family:'Sentient',serif;font-size:clamp(28px,7vw,36px);font-weight:700;line-height:1.08}
.greeting-title em{font-style:italic;color:var(--gold)}

/* HERO CARD */
.hero-card{margin:20px 22px 0;background:linear-gradient(135deg,#1a2e1a 0%,#0f1f0f 100%);border:1px solid rgba(240,192,64,.18);border-radius:26px;padding:24px;position:relative;overflow:hidden;box-shadow:var(--sh2),0 0 30px rgba(240,192,64,.2);animation:fadeDown .6s .14s ease both}
.hero-card::before{content:'';position:absolute;top:-60px;right:-60px;width:200px;height:200px;background:radial-gradient(circle,rgba(240,192,64,.12) 0%,transparent 70%);pointer-events:none}
.hero-card::after{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,rgba(240,192,64,.4),transparent)}
.hero-top{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:20px}
.hero-pct{font-family:'Clash Display',sans-serif;font-size:72px;font-weight:700;line-height:1;letter-spacing:-.02em;color:var(--gold)}
.hero-pct-sym{font-size:30px;color:rgba(240,192,64,.45)}
.hero-pct-lbl{font-size:11px;font-weight:500;letter-spacing:.12em;text-transform:uppercase;color:var(--txt3);margin-top:3px}
.hero-right{display:flex;flex-direction:column;align-items:flex-end;gap:14px}
.hero-stat-val{font-family:'Clash Display',sans-serif;font-size:28px;font-weight:600;color:var(--txt);line-height:1;text-align:right}
.hero-stat-lbl{font-size:10px;color:var(--txt3);text-transform:uppercase;letter-spacing:.1em;text-align:right}
.prog-track{height:8px;background:rgba(255,255,255,.07);border-radius:4px;overflow:hidden;margin-bottom:16px}
.prog-fill{height:100%;border-radius:4px;background:linear-gradient(90deg,var(--grn2),var(--gold));transition:width 1.4s cubic-bezier(.4,0,.2,1);position:relative}
.prog-fill::after{content:'';position:absolute;right:0;top:50%;transform:translate(50%,-50%);width:14px;height:14px;background:var(--gold);border-radius:50%;box-shadow:0 0 10px rgba(240,192,64,.6),0 0 0 3px rgba(240,192,64,.15)}
.hero-msg{font-family:'Sentient',serif;font-style:italic;font-size:14px;color:rgba(240,224,192,.55)}

/* STREAKS */
.streaks-row{margin:14px 22px 0;display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;animation:fadeDown .6s .2s ease both}
.streak-chip{background:var(--s1);border:1px solid var(--bd);border-radius:18px;padding:14px 12px;display:flex;flex-direction:column;align-items:center;gap:4px;box-shadow:var(--sh);transition:all .2s}
.streak-chip:active{transform:scale(.96)}
.streak-chip-icon{font-size:20px}
.streak-chip-val{font-family:'Clash Display',sans-serif;font-size:24px;font-weight:600;line-height:1}
.streak-chip-lbl{font-size:9px;color:var(--txt3);text-transform:uppercase;letter-spacing:.1em;font-weight:500}
.streak-chip.fire .streak-chip-val{color:var(--coral)}
.streak-chip.star .streak-chip-val{color:var(--gold)}
.streak-chip.bolt .streak-chip-val{color:var(--sky)}

/* WEEK */
.week-section{margin:22px 22px 0;animation:fadeDown .6s .26s ease both}
.section-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.section-label{font-size:11px;font-weight:600;letter-spacing:.14em;text-transform:uppercase;color:var(--txt3)}
.section-action{font-size:11px;font-weight:600;color:var(--gold);cursor:pointer;letter-spacing:.05em}
.week-strip{display:flex;gap:6px}
.week-col{flex:1;display:flex;flex-direction:column;align-items:center;gap:5px}
.week-name{font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:.1em;color:var(--txt4)}
.week-pip{width:100%;aspect-ratio:1;border-radius:11px;background:var(--s2);border:1px solid var(--bd);display:flex;align-items:center;justify-content:center;font-family:'Clash Display',sans-serif;font-size:13px;font-weight:600;color:var(--txt3);transition:all .3s}
.week-pip.today{background:var(--gold);color:var(--bg);border-color:transparent;box-shadow:0 4px 14px rgba(240,192,64,.35)}
.week-pip.full{background:linear-gradient(135deg,var(--grn2),var(--grn));color:#fff;border-color:transparent;box-shadow:0 4px 12px rgba(46,204,113,.3)}
.week-pip.partial{background:var(--s3);border-color:rgba(240,192,64,.3);color:var(--gold)}
.week-sub{font-size:8px;color:var(--txt4);min-height:11px}

/* HABITS LIST */
.habits-section{margin:22px 22px 0;animation:fadeDown .6s .32s ease both}
.habits-list{display:flex;flex-direction:column;gap:9px}
.habit-card{background:var(--s1);border:1px solid var(--bd);border-radius:20px;overflow:hidden;box-shadow:var(--sh);transition:all .25s;animation:slideIn .4s ease both;cursor:pointer}
.habit-card:active{transform:scale(.985)}
.habit-card.done{border-color:rgba(46,204,113,.2)}
.habit-accent{height:3px}
.habit-inner{padding:14px 16px;display:flex;align-items:center;gap:12px}
.habit-icon-box{width:46px;height:46px;flex-shrink:0;border-radius:14px;background:var(--s2);border:1px solid var(--bd);display:flex;align-items:center;justify-content:center;font-size:22px;cursor:pointer;transition:all .2s}
.habit-icon-box:hover{transform:scale(1.08)}
.habit-card.done .habit-icon-box{background:rgba(46,204,113,.1);border-color:rgba(46,204,113,.2)}
.habit-body{flex:1;min-width:0}
.habit-name{font-size:15px;font-weight:600;color:var(--txt);margin-bottom:5px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.habit-card.done .habit-name{color:var(--txt3);text-decoration:line-through;text-decoration-color:var(--grn)}
.habit-meta{display:flex;align-items:center;gap:8px}
.habit-stag{font-size:11px;font-weight:700;color:var(--coral);background:rgba(255,90,60,.09);padding:2px 7px;border-radius:20px;font-family:'Clash Display',sans-serif;white-space:nowrap}
.habit-bar{flex:1;height:3px;background:rgba(255,255,255,.06);border-radius:2px;overflow:hidden}
.habit-bar-fill{height:100%;border-radius:2px;transition:width .8s}
.habit-pct{font-size:10px;color:var(--txt4);white-space:nowrap}
.habit-check{width:32px;height:32px;flex-shrink:0;border-radius:10px;border:2px solid var(--bd2);display:flex;align-items:center;justify-content:center;font-size:15px;color:transparent;cursor:pointer;transition:all .3s cubic-bezier(.34,1.56,.64,1)}
.habit-card.done .habit-check{background:var(--grn);border-color:var(--grn);color:#fff;box-shadow:0 4px 12px rgba(46,204,113,.35);transform:scale(1.08)}

/* EMPTY */
.empty-state{text-align:center;padding:48px 20px}
.empty-icon{font-size:52px;margin-bottom:14px;display:block}
.empty-head{font-family:'Sentient',serif;font-size:22px;font-weight:700;color:var(--txt2);margin-bottom:6px;font-style:italic}
.empty-body{font-size:14px;line-height:1.6;color:var(--txt3)}

/* JOURNAL */
.journal-section{margin:22px 22px 0;animation:fadeDown .6s .38s ease both}
.journal-card{background:var(--s1);border:1px solid var(--bd);border-radius:22px;padding:18px;box-shadow:var(--sh)}
.journal-head{display:flex;align-items:center;gap:9px;margin-bottom:13px}
.journal-icon-box{width:32px;height:32px;border-radius:10px;background:linear-gradient(135deg,var(--gold),var(--coral));display:flex;align-items:center;justify-content:center;font-size:15px}
.journal-title{font-family:'Clash Display',sans-serif;font-size:16px;font-weight:600;color:var(--txt)}
.journal-sub{font-size:11px;color:var(--txt3);margin-top:2px}
.journal-area{width:100%;background:var(--s2);border:1px solid var(--bd);border-radius:13px;padding:13px 15px;font-family:'DM Sans',sans-serif;font-style:italic;font-size:15px;color:var(--txt);resize:none;height:86px;outline:none;transition:border-color .2s;line-height:1.6}
.journal-area::placeholder{color:var(--txt3)}
.journal-area:focus{border-color:rgba(240,192,64,.3);background:var(--s3)}

/* QUOTE */
.quote-section{margin:14px 22px 0;animation:fadeDown .6s .44s ease both}
.quote-card{background:linear-gradient(135deg,var(--s2),var(--bg));border:1px solid rgba(240,192,64,.12);border-radius:22px;padding:20px 22px;position:relative;overflow:hidden}
.quote-card::before{content:'\201C';position:absolute;top:-16px;left:14px;font-family:'Sentient',serif;font-size:90px;line-height:1;color:rgba(240,192,64,.08)}
.quote-text{font-family:'Sentient',serif;font-style:italic;font-size:15px;line-height:1.65;color:rgba(240,237,232,.6);margin-bottom:8px;position:relative}
.quote-author{font-size:10px;color:var(--gold);text-transform:uppercase;letter-spacing:.12em;font-weight:600}

/* ‚îÄ‚îÄ STATS VIEW ‚îÄ‚îÄ */
.page-title{font-family:'Sentient',serif;font-size:30px;font-weight:700;color:var(--txt)}
.page-title em{font-style:italic;color:var(--gold)}
.page-sub{font-size:13px;color:var(--txt3);margin-top:3px}
.stats-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:4px}
.stat-tile{background:var(--s1);border:1px solid var(--bd);border-radius:20px;padding:20px 18px;box-shadow:var(--sh);position:relative;overflow:hidden}
.stat-tile::after{content:'';position:absolute;bottom:0;left:0;right:0;height:2px;background:var(--tc,var(--gold))}
.stat-tile-icon{font-size:24px;margin-bottom:10px;display:block}
.stat-tile-val{font-family:'Clash Display',sans-serif;font-size:38px;font-weight:700;line-height:1;color:var(--tc,var(--gold));margin-bottom:4px}
.stat-tile-lbl{font-size:11px;color:var(--txt3);text-transform:uppercase;letter-spacing:.1em;font-weight:600}
.habits-breakdown{display:flex;flex-direction:column;gap:10px}
.breakdown-card{background:var(--s1);border:1px solid var(--bd);border-radius:20px;padding:18px;box-shadow:var(--sh)}
.bc-header{display:flex;align-items:center;gap:10px;margin-bottom:14px}
.bc-icon{font-size:22px}.bc-name{font-size:15px;font-weight:600;color:var(--txt);flex:1}
.bc-streak{font-family:'Clash Display',sans-serif;font-size:18px;font-weight:700}
.bc-bars{display:flex;gap:3px;height:28px;align-items:flex-end}
.bc-bar{flex:1;border-radius:3px 3px 0 0;min-height:3px;transition:height .5s ease}
.bc-footer{display:flex;justify-content:space-between;margin-top:10px}
.bc-stat{text-align:center}
.bc-stat-val{font-family:'Clash Display',sans-serif;font-size:18px;font-weight:700;color:var(--txt)}
.bc-stat-lbl{font-size:9px;color:var(--txt3);text-transform:uppercase;letter-spacing:.08em}

/* ‚îÄ‚îÄ HISTORY VIEW ‚îÄ‚îÄ */
.month-hdr{font-family:'Clash Display',sans-serif;font-size:18px;font-weight:600;color:var(--txt2);letter-spacing:.04em;text-transform:uppercase;margin:8px 0 10px}
.cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:5px;margin-bottom:20px}
.cal-dn{text-align:center;font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:.1em;color:var(--txt4);padding-bottom:4px}
.cal-d{aspect-ratio:1;border-radius:10px;background:var(--s1);border:1px solid var(--bd);display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:600;color:var(--txt4)}
.cal-d.emp{background:transparent;border-color:transparent}
.cal-d.today{border-color:var(--gold);color:var(--gold);font-weight:700}
.cal-d.perfect{background:linear-gradient(135deg,var(--grn2),var(--grn));color:#fff;border-color:transparent;box-shadow:0 3px 10px rgba(46,204,113,.3)}
.cal-d.partial{background:var(--s3);border-color:rgba(240,192,64,.25);color:var(--gold2)}
.legend{display:flex;gap:14px;flex-wrap:wrap;margin-top:4px}
.legend-item{display:flex;align-items:center;gap:6px;font-size:11px;color:var(--txt3)}
.legend-dot{width:10px;height:10px;border-radius:3px}

/* ‚îÄ‚îÄ SETTINGS VIEW ‚îÄ‚îÄ */
.profile-card{background:linear-gradient(135deg,var(--s2),var(--s1));border:1px solid rgba(240,192,64,.15);border-radius:20px;padding:20px;display:flex;align-items:center;gap:14px;box-shadow:var(--sh)}
.profile-avatar{width:56px;height:56px;border-radius:18px;background:linear-gradient(135deg,var(--gold),var(--coral));display:flex;align-items:center;justify-content:center;font-size:26px;flex-shrink:0}
.profile-name{font-family:'Clash Display',sans-serif;font-size:20px;font-weight:600}
.profile-tagline{font-size:12px;color:var(--txt3);margin-top:3px}
.settings-section-title{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.16em;color:var(--txt4);margin:8px 0 6px}
.settings-group{background:var(--s1);border:1px solid var(--bd);border-radius:20px;overflow:hidden}
.settings-row{display:flex;align-items:center;gap:13px;padding:15px 18px;border-bottom:1px solid var(--bd);cursor:pointer;transition:background .15s}
.settings-row:last-child{border-bottom:none}
.settings-row:hover{background:var(--s2)}
.settings-row:active{background:var(--s3)}
.settings-row-icon{width:36px;height:36px;border-radius:11px;display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0}
.settings-row-body{flex:1}
.settings-row-title{font-size:14px;font-weight:600}
.settings-row-sub{font-size:11px;color:var(--txt3);margin-top:2px}
.settings-row-right{color:var(--txt4);font-size:13px}
.toggle{width:44px;height:26px;border-radius:13px;background:var(--s3);border:1px solid var(--bd2);position:relative;cursor:pointer;transition:background .2s;flex-shrink:0}
.toggle.on{background:var(--grn);border-color:var(--grn)}
.toggle-thumb{position:absolute;top:3px;left:3px;width:18px;height:18px;border-radius:50%;background:#fff;transition:left .2s cubic-bezier(.34,1.56,.64,1);box-shadow:0 2px 6px rgba(0,0,0,.3)}
.toggle.on .toggle-thumb{left:21px}
.danger-btn{width:100%;padding:16px;border-radius:16px;background:transparent;border:1px solid rgba(255,90,60,.2);color:var(--coral);font-family:'DM Sans',sans-serif;font-size:14px;font-weight:700;cursor:pointer;transition:all .2s}
.danger-btn:hover{background:rgba(255,90,60,.07);border-color:var(--coral)}

/* BOTTOM NAV */
.bottom-nav{position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:100%;max-width:480px;background:rgba(10,15,10,.9);backdrop-filter:blur(24px) saturate(1.5);border-top:1px solid var(--bd);padding:9px 8px 24px;display:flex;justify-content:space-around;z-index:200}
.nav-tab{display:flex;flex-direction:column;align-items:center;gap:3px;padding:7px 0;border-radius:14px;cursor:pointer;transition:all .2s;opacity:.38;user-select:none;flex:1}
.nav-tab.active{opacity:1;background:rgba(240,192,64,.1)}
.nav-tab-icon{font-size:20px}
.nav-tab-lbl{font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:.1em;color:var(--txt3)}
.nav-tab.active .nav-tab-lbl{color:var(--gold)}

/* MODALS */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.7);backdrop-filter:blur(8px);z-index:300;display:flex;align-items:flex-end;opacity:0;pointer-events:none;transition:opacity .3s}
.modal-overlay.open{opacity:1;pointer-events:all}
.modal-sheet{width:100%;max-width:480px;margin:0 auto;background:var(--s1);border-radius:28px 28px 0 0;border:1px solid var(--bd2);border-bottom:none;transform:translateY(100%);transition:transform .42s cubic-bezier(.34,1.08,.64,1);max-height:90vh;overflow-y:auto;padding:0 22px 44px;box-shadow:0 -20px 60px rgba(0,0,0,.5)}
.modal-overlay.open .modal-sheet{transform:translateY(0)}
.modal-handle{width:40px;height:4px;background:var(--bd2);border-radius:2px;margin:14px auto 22px}
.modal-title{font-family:'Clash Display',sans-serif;font-size:26px;font-weight:600;color:var(--txt);letter-spacing:.02em;margin-bottom:22px}
.form-lbl{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.14em;color:var(--txt3);display:block;margin-bottom:8px}
.form-input{width:100%;background:var(--s2);border:1.5px solid var(--bd2);border-radius:14px;padding:14px 16px;font-family:'DM Sans',sans-serif;font-size:15px;font-weight:500;color:var(--txt);outline:none;margin-bottom:20px;transition:border-color .2s}
.form-input:focus{border-color:var(--gold)}
.form-input::placeholder{color:var(--txt4);font-weight:400}
.emoji-grid{display:grid;grid-template-columns:repeat(8,1fr);gap:7px;margin-bottom:20px}
.eg-item{aspect-ratio:1;border-radius:12px;background:var(--s2);border:2px solid transparent;display:flex;align-items:center;justify-content:center;font-size:20px;cursor:pointer;transition:all .18s cubic-bezier(.34,1.56,.64,1)}
.eg-item:hover{transform:scale(1.1)}
.eg-item.sel{border-color:var(--gold);background:rgba(240,192,64,.1);transform:scale(1.08)}
.color-row{display:flex;gap:9px;margin-bottom:24px;flex-wrap:wrap}
.cr-item{width:32px;height:32px;border-radius:10px;cursor:pointer;border:3px solid transparent;transition:all .2s cubic-bezier(.34,1.56,.64,1)}
.cr-item:hover{transform:scale(1.1)}
.cr-item.sel{border-color:#fff;transform:scale(1.18);box-shadow:0 4px 12px rgba(0,0,0,.4)}
.primary-btn{width:100%;padding:16px;border:none;border-radius:16px;background:linear-gradient(135deg,var(--grn),var(--gold));color:var(--bg);font-family:'DM Sans',sans-serif;font-size:16px;font-weight:800;cursor:pointer;box-shadow:0 8px 28px rgba(46,204,113,.25);transition:all .2s;letter-spacing:.02em;position:relative;overflow:hidden}
.primary-btn::after{content:'';position:absolute;top:0;left:-100%;width:50%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.15),transparent);transition:left .5s}
.primary-btn:hover::after{left:180%}
.primary-btn:hover{transform:translateY(-2px);box-shadow:0 12px 36px rgba(46,204,113,.35)}
.primary-btn:active{transform:scale(.98)}

/* DETAIL */
.detail-hero{display:flex;align-items:center;gap:14px;margin-bottom:22px}
.detail-icon-wrap{width:60px;height:60px;border-radius:20px;display:flex;align-items:center;justify-content:center;font-size:30px}
.detail-name{font-family:'Clash Display',sans-serif;font-size:24px;font-weight:600}
.detail-since{font-size:12px;color:var(--txt3);margin-top:3px;font-style:italic}
.detail-stats{display:grid;grid-template-columns:1fr 1fr 1fr;gap:9px;margin-bottom:20px}
.ds-cell{background:var(--s2);border:1px solid var(--bd);border-radius:16px;padding:14px 10px;text-align:center}
.ds-val{font-family:'Clash Display',sans-serif;font-size:26px;font-weight:700;line-height:1;margin-bottom:3px}
.ds-lbl{font-size:9px;color:var(--txt3);text-transform:uppercase;letter-spacing:.09em;font-weight:600}
.mini-cal-head{font-size:11px;color:var(--txt3);font-style:italic;margin-bottom:9px;font-family:'Sentient',serif}
.mini-cal{display:grid;grid-template-columns:repeat(7,1fr);gap:4px;margin-bottom:22px}
.mc{aspect-ratio:1;border-radius:8px;background:var(--s2);border:1px solid var(--bd);display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:600;color:var(--txt4)}
.mc.d{background:linear-gradient(135deg,var(--grn2),var(--grn));border-color:transparent;color:#fff}
.mc.t{border-color:var(--gold);color:var(--gold);font-weight:800}
.del-btn{width:100%;padding:14px;border-radius:14px;background:transparent;border:1.5px solid rgba(255,90,60,.22);color:var(--coral);font-family:'DM Sans',sans-serif;font-size:14px;font-weight:700;cursor:pointer;transition:all .2s}
.del-btn:hover{background:rgba(255,90,60,.07);border-color:var(--coral)}

/* CONFIRM */
.confirm-body{text-align:center;padding-bottom:8px}
.confirm-icon{font-size:48px;margin-bottom:14px;display:block}
.confirm-title{font-family:'Clash Display',sans-serif;font-size:22px;font-weight:600;margin-bottom:8px}
.confirm-msg{font-size:14px;color:var(--txt3);line-height:1.6;margin-bottom:24px}
.confirm-btns{display:flex;gap:10px}
.confirm-cancel{flex:1;padding:14px;border-radius:14px;background:var(--s2);border:1px solid var(--bd2);color:var(--txt2);font-family:'DM Sans',sans-serif;font-size:14px;font-weight:600;cursor:pointer;transition:all .2s}
.confirm-cancel:hover{background:var(--s3)}
.confirm-ok{flex:1;padding:14px;border-radius:14px;background:rgba(255,90,60,.1);border:1px solid rgba(255,90,60,.3);color:var(--coral);font-family:'DM Sans',sans-serif;font-size:14px;font-weight:700;cursor:pointer;transition:all .2s}
.confirm-ok:hover{background:rgba(255,90,60,.18);border-color:var(--coral)}

/* TOAST */
.toast{position:fixed;top:20px;left:50%;transform:translateX(-50%) translateY(-80px);z-index:500;background:var(--s2);color:var(--txt);border:1px solid var(--bd2);font-size:14px;font-weight:600;padding:12px 22px;border-radius:40px;box-shadow:0 8px 32px rgba(0,0,0,.5);transition:transform .4s cubic-bezier(.34,1.3,.64,1);white-space:nowrap;pointer-events:none}
.toast.show{transform:translateX(-50%) translateY(0)}

/* NAME MODAL */
.name-modal-sub{font-size:14px;color:var(--txt3);margin-bottom:20px;line-height:1.6}

@keyframes fadeDown{from{opacity:0;transform:translateY(-14px)}to{opacity:1;transform:translateY(0)}}
@keyframes slideIn{from{opacity:0;transform:translateX(-10px)}to{opacity:1;transform:translateX(0)}}
::-webkit-scrollbar{width:3px}
::-webkit-scrollbar-thumb{background:var(--bd2);border-radius:2px}
</style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê‚ïê HOME ‚ïê‚ïê‚ïê‚ïê -->
<div id="view-home" class="view active">
  <div class="topbar">
    <div class="logo"><span class="logo-pip"></span>STREAK</div>
    <div class="topbar-right">
      <div class="icon-btn" id="notifBtn">üîî</div>
      <div class="icon-btn" id="addBtn1">Ôºã</div>
    </div>
  </div>

  <div class="greeting-block">
    <div class="greeting-eyebrow"><span class="live-dot"></span><span id="liveDateStr"></span></div>
    <div class="greeting-title" id="greetTitle">Good <em>morning.</em></div>
  </div>

  <div class="hero-card">
    <div class="hero-top">
      <div>
        <div class="hero-pct"><span id="todayPct">0</span><span class="hero-pct-sym">%</span></div>
        <div class="hero-pct-lbl">Today's Progress</div>
      </div>
      <div class="hero-right">
        <div><div class="hero-stat-val" id="heroDone">0</div><div class="hero-stat-lbl">Done</div></div>
        <div><div class="hero-stat-val" id="heroLeft">0</div><div class="hero-stat-lbl">Left</div></div>
      </div>
    </div>
    <div class="prog-track"><div class="prog-fill" id="progFill" style="width:0%"></div></div>
    <div class="hero-msg" id="heroMsg">Ready to build something great today?</div>
  </div>

  <div class="streaks-row">
    <div class="streak-chip fire"><div class="streak-chip-icon">üî•</div><div class="streak-chip-val" id="chipStreak">0</div><div class="streak-chip-lbl">Streak</div></div>
    <div class="streak-chip star"><div class="streak-chip-icon">‚≠ê</div><div class="streak-chip-val" id="chipWins">0</div><div class="streak-chip-lbl">Wins</div></div>
    <div class="streak-chip bolt"><div class="streak-chip-icon">‚ö°</div><div class="streak-chip-val" id="chipPerfect">0</div><div class="streak-chip-lbl">Perfect</div></div>
  </div>

  <div class="week-section">
    <div class="section-head"><div class="section-label">This Week</div></div>
    <div class="week-strip" id="weekStrip"></div>
  </div>

  <div class="habits-section">
    <div class="section-head">
      <div class="section-label">Today's Habits</div>
      <div class="section-action" id="addBtn2">+ Add New</div>
    </div>
    <div class="habits-list" id="habitsList"></div>
  </div>

  <div class="journal-section">
    <div class="journal-card">
      <div class="journal-head">
        <div class="journal-icon-box">‚úçÔ∏è</div>
        <div><div class="journal-title">Daily Journal</div><div class="journal-sub">Capture your thoughts</div></div>
      </div>
      <textarea class="journal-area" id="journalArea" placeholder="How are you feeling today? What will you focus on..."></textarea>
    </div>
  </div>

  <div class="quote-section">
    <div class="quote-card">
      <div class="quote-text" id="quoteText"></div>
      <div class="quote-author" id="quoteAuthor"></div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê STATS ‚ïê‚ïê‚ïê‚ïê -->
<div id="view-stats" class="view">
  <div class="page-title">Your <em>Stats</em></div>
  <div class="page-sub">All-time performance overview</div>
  <div class="stats-grid">
    <div class="stat-tile" style="--tc:var(--gold)"><span class="stat-tile-icon">üî•</span><div class="stat-tile-val" id="st-streak">0</div><div class="stat-tile-lbl">Best Streak</div></div>
    <div class="stat-tile" style="--tc:var(--grn)"><span class="stat-tile-icon">‚úÖ</span><div class="stat-tile-val" id="st-total">0</div><div class="stat-tile-lbl">Total Wins</div></div>
    <div class="stat-tile" style="--tc:var(--sky)"><span class="stat-tile-icon">‚ö°</span><div class="stat-tile-val" id="st-perfect">0</div><div class="stat-tile-lbl">Perfect Days</div></div>
    <div class="stat-tile" style="--tc:var(--blush)"><span class="stat-tile-icon">üìä</span><div class="stat-tile-val" id="st-rate">0%</div><div class="stat-tile-lbl">30-Day Rate</div></div>
  </div>
  <div class="section-label" style="margin-top:8px">Habit Breakdown</div>
  <div class="habits-breakdown" id="habitsBreakdown">
    <div class="empty-state" style="padding:30px 20px"><span class="empty-icon">üìä</span><div class="empty-head">No data yet</div><div class="empty-body">Add habits and start tracking to see stats here.</div></div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê HISTORY ‚ïê‚ïê‚ïê‚ïê -->
<div id="view-history" class="view">
  <div class="page-title"><em>History</em></div>
  <div class="page-sub">Your habit calendar</div>
  <div class="legend">
    <div class="legend-item"><div class="legend-dot" style="background:linear-gradient(135deg,var(--grn2),var(--grn))"></div>Perfect day</div>
    <div class="legend-item"><div class="legend-dot" style="background:var(--s3);border:1px solid rgba(240,192,64,.3)"></div>Partial</div>
    <div class="legend-item"><div class="legend-dot" style="background:var(--s1);border:1px solid var(--bd)"></div>No activity</div>
  </div>
  <div id="calContainer"></div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê SETTINGS ‚ïê‚ïê‚ïê‚ïê -->
<div id="view-settings" class="view">
  <div class="profile-card">
    <div class="profile-avatar">üåø</div>
    <div>
      <div class="profile-name" id="profileName">Habit Builder</div>
      <div class="profile-tagline" id="profileTagline">Start your journey today</div>
    </div>
  </div>

  <div class="settings-section-title">Preferences</div>
  <div class="settings-group">
    <div class="settings-row" id="setNameRow">
      <div class="settings-row-icon" style="background:rgba(240,192,64,.1)">‚úèÔ∏è</div>
      <div class="settings-row-body"><div class="settings-row-title">Your Name</div><div class="settings-row-sub" id="nameDisplay">Tap to set your name</div></div>
      <div class="settings-row-right">‚Ä∫</div>
    </div>
    <div class="settings-row" id="remindRow">
      <div class="settings-row-icon" style="background:rgba(91,200,245,.1)">üîî</div>
      <div class="settings-row-body"><div class="settings-row-title">Daily Reminder</div><div class="settings-row-sub">Get a nudge each morning</div></div>
      <div class="toggle" id="toggle-remind"><div class="toggle-thumb"></div></div>
    </div>
    <div class="settings-row" id="celebRow">
      <div class="settings-row-icon" style="background:rgba(46,204,113,.1)">üéâ</div>
      <div class="settings-row-body"><div class="settings-row-title">Streak Celebrations</div><div class="settings-row-sub">Celebrate milestones</div></div>
      <div class="toggle on" id="toggle-celebrate"><div class="toggle-thumb"></div></div>
    </div>
  </div>

  <div class="settings-section-title">Data</div>
  <div class="settings-group">
    <div class="settings-row" id="exportRow">
      <div class="settings-row-icon" style="background:rgba(91,200,245,.1)">üì§</div>
      <div class="settings-row-body"><div class="settings-row-title">Export Data</div><div class="settings-row-sub">Download as JSON file</div></div>
      <div class="settings-row-right">‚Ä∫</div>
    </div>
    <div class="settings-row" id="shareRow">
      <div class="settings-row-icon" style="background:rgba(46,204,113,.1)">üìã</div>
      <div class="settings-row-body"><div class="settings-row-title">Copy Stats</div><div class="settings-row-sub">Share your progress</div></div>
      <div class="settings-row-right">‚Ä∫</div>
    </div>
  </div>

  <div class="settings-section-title">App</div>
  <div class="settings-group">
    <div class="settings-row">
      <div class="settings-row-icon" style="background:rgba(240,192,64,.1)">üåø</div>
      <div class="settings-row-body"><div class="settings-row-title">Streak</div><div class="settings-row-sub">Version 2.0 ¬∑ 100% Free ¬∑ No subscriptions</div></div>
      <div class="settings-row-right">‚ù§Ô∏è</div>
    </div>
  </div>

  <button class="danger-btn" id="resetBtn">‚ö†Ô∏è Reset All Data</button>
</div>

<!-- BOTTOM NAV -->
<div class="bottom-nav">
  <div class="nav-tab active" data-v="view-home"><div class="nav-tab-icon">üè†</div><div class="nav-tab-lbl">Today</div></div>
  <div class="nav-tab" data-v="view-stats"><div class="nav-tab-icon">üìä</div><div class="nav-tab-lbl">Stats</div></div>
  <div class="nav-tab" data-v="view-history"><div class="nav-tab-icon">üóì</div><div class="nav-tab-lbl">History</div></div>
  <div class="nav-tab" data-v="view-settings"><div class="nav-tab-icon">‚öôÔ∏è</div><div class="nav-tab-lbl">Settings</div></div>
</div>

<!-- ADD HABIT MODAL -->
<div class="modal-overlay" id="addModal">
  <div class="modal-sheet">
    <div class="modal-handle"></div>
    <div class="modal-title">New Habit ‚ú®</div>
    <label class="form-lbl">Habit Name</label>
    <input type="text" class="form-input" id="newHabitName" placeholder="e.g. Morning run, Read 20 pages...">
    <label class="form-lbl">Pick an Icon</label>
    <div class="emoji-grid" id="emojiGrid"></div>
    <label class="form-lbl">Choose a Color</label>
    <div class="color-row" id="colorRow"></div>
    <button class="primary-btn" id="saveHabitBtn">Create Habit ‚Üí</button>
  </div>
</div>

<!-- DETAIL MODAL -->
<div class="modal-overlay" id="detailModal">
  <div class="modal-sheet"><div class="modal-handle"></div><div id="detailBody"></div></div>
</div>

<!-- NAME MODAL -->
<div class="modal-overlay" id="nameModal">
  <div class="modal-sheet">
    <div class="modal-handle"></div>
    <div class="modal-title">What's your name?</div>
    <p class="name-modal-sub">We'll personalize your experience.</p>
    <label class="form-lbl">Your Name</label>
    <input type="text" class="form-input" id="nameInput" placeholder="e.g. Alex, Sarah...">
    <button class="primary-btn" id="saveNameBtn">Save ‚Üí</button>
  </div>
</div>

<!-- CONFIRM MODAL -->
<div class="modal-overlay" id="confirmModal">
  <div class="modal-sheet"><div class="modal-handle"></div><div class="confirm-body" id="confirmBody"></div></div>
</div>

<div class="toast" id="toast"></div>

<script>
const EMOJIS=['üßò','üèÉ','üíß','üìö','ü•ó','üí™','üò¥','‚úçÔ∏è','üéØ','üéµ','üåø','üß†','‚òÄÔ∏è','üö¥','üçé','üåô','üèãÔ∏è','üé®','üõÅ','üßπ','üêï','üíä','üö∂','üé§'];
const COLORS=['#f0c040','#2ecc71','#ff5a3c','#5bc8f5','#f5849a','#a78bfa','#fb923c','#34d399','#60a5fa','#f472b6'];
const QUOTES=[
  {t:"We are what we repeatedly do. Excellence is not an act, but a habit.",a:"Aristotle"},
  {t:"The secret of your future is hidden in your daily routine.",a:"Mike Murdock"},
  {t:"You don't rise to the level of your goals. You fall to the level of your systems.",a:"James Clear"},
  {t:"A year from now you may wish you had started today.",a:"Karen Lamb"},
  {t:"Small daily improvements over time lead to stunning results.",a:"Robin Sharma"},
  {t:"Motivation gets you going but habit gets you there.",a:"Jim Ryun"},
  {t:"It's not what we do once in a while that shapes our lives. It's what we do consistently.",a:"Tony Robbins"},
  {t:"Success is the sum of small efforts, repeated day in and day out.",a:"Robert Collier"},
];

let S=JSON.parse(localStorage.getItem('streak_v5')||'null')||{habits:[],completions:{},journal:{},totalWins:0,streak:0,perfectDays:0,userName:'',settings:{remind:false,celebrate:true}};
const save=()=>localStorage.setItem('streak_v5',JSON.stringify(S));
const todayKey=()=>new Date().toISOString().slice(0,10);
const mk=(tag,cls)=>{const e=document.createElement(tag);if(cls)e.className=cls;return e;};

/* ‚îÄ‚îÄ NAV ‚îÄ‚îÄ */
document.querySelectorAll('.nav-tab').forEach(t=>{
  t.addEventListener('click',()=>{
    document.querySelectorAll('.nav-tab').forEach(x=>x.classList.remove('active'));
    t.classList.add('active');
    document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));
    document.getElementById(t.dataset.v).classList.add('active');
    if(t.dataset.v==='view-stats')   renderStats();
    if(t.dataset.v==='view-history') renderHistory();
    if(t.dataset.v==='view-settings')renderSettings();
    window.scrollTo(0,0);
  });
});

/* ‚îÄ‚îÄ BOOT ‚îÄ‚îÄ */
function init(){
  setGreeting(); setQuote(); buildWeek(); renderHabits(); refreshHero(); loadJournal();
  buildEmojiGrid(); buildColorRow();
  // wire all buttons
  document.getElementById('addBtn1').onclick=()=>openModal('addModal');
  document.getElementById('addBtn2').onclick=()=>openModal('addModal');
  document.getElementById('notifBtn').onclick=()=>toast('üîî Reminders coming soon!');
  document.getElementById('saveHabitBtn').onclick=createHabit;
  document.getElementById('newHabitName').addEventListener('keydown',e=>{if(e.key==='Enter')createHabit();});
  document.getElementById('saveNameBtn').onclick=saveName;
  document.getElementById('nameInput').addEventListener('keydown',e=>{if(e.key==='Enter')saveName();});
  document.getElementById('setNameRow').onclick=()=>{document.getElementById('nameInput').value=S.userName||'';openModal('nameModal');};
  document.getElementById('remindRow').onclick=()=>{
    const t=document.getElementById('toggle-remind');
    t.classList.toggle('on'); S.settings.remind=t.classList.contains('on'); save();
    toast(S.settings.remind?'üîî Reminder enabled':'üîï Reminder disabled');
  };
  document.getElementById('celebRow').onclick=()=>{
    const t=document.getElementById('toggle-celebrate');
    t.classList.toggle('on'); S.settings.celebrate=t.classList.contains('on'); save();
    toast(S.settings.celebrate?'üéâ Celebrations on':'Celebrations off');
  };
  document.getElementById('exportRow').onclick=exportData;
  document.getElementById('shareRow').onclick=shareStats;
  document.getElementById('resetBtn').onclick=confirmReset;
  ['addModal','detailModal','nameModal','confirmModal'].forEach(id=>{
    document.getElementById(id).addEventListener('click',e=>{if(e.target.id===id)closeModal(id);});
  });
  document.getElementById('journalArea').addEventListener('input',()=>{S.journal[todayKey()]=document.getElementById('journalArea').value;save();});
}

/* ‚îÄ‚îÄ GREETING ‚îÄ‚îÄ */
function setGreeting(){
  const h=new Date().getHours(),g=h<12?'morning':h<17?'afternoon':'evening';
  document.getElementById('greetTitle').innerHTML=`Good <em>${g}.</em>`;
  const d=new Date(),days=['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'],months=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
  document.getElementById('liveDateStr').textContent=`${days[d.getDay()]}, ${months[d.getMonth()]} ${d.getDate()}`;
}
function setQuote(){const q=QUOTES[new Date().getDay()%QUOTES.length];document.getElementById('quoteText').textContent=q.t;document.getElementById('quoteAuthor').textContent='‚Äî '+q.a;}

/* ‚îÄ‚îÄ HERO ‚îÄ‚îÄ */
function refreshHero(){
  const tk=todayKey(),done=(S.completions[tk]||[]).length,total=S.habits.length,pct=total>0?Math.round(done/total*100):0;
  document.getElementById('todayPct').textContent=pct;
  document.getElementById('progFill').style.width=pct+'%';
  document.getElementById('heroDone').textContent=done;
  document.getElementById('heroLeft').textContent=total-done;
  const msgs=['Ready to build something great today? üåÖ',`${done} down, ${total-done} to go ‚Äî keep going!`,'Halfway there ‚Äî momentum is building!',`Almost there! Just ${total-done} left.`,'Perfect day! Every habit crushed! üéâ'];
  document.getElementById('heroMsg').textContent=msgs[pct===100?4:pct>=75?3:pct>=50?2:pct>0?1:0];
  recalcMeta();
  document.getElementById('chipStreak').textContent=S.streak||0;
  document.getElementById('chipWins').textContent=S.totalWins||0;
  document.getElementById('chipPerfect').textContent=S.perfectDays||0;
}
function recalcMeta(){
  let s=0;const now=new Date();
  for(let i=0;i<365;i++){const d=new Date(now);d.setDate(now.getDate()-i);const k=d.toISOString().slice(0,10);const dn=(S.completions[k]||[]).length;if(dn===0&&i>0)break;if(dn>0)s++;}
  S.streak=s;
  const n=S.habits.length;let p=0;
  if(n>0)Object.values(S.completions).forEach(a=>{if(a.length>=n)p++;});
  S.perfectDays=p;
}

/* ‚îÄ‚îÄ WEEK ‚îÄ‚îÄ */
function buildWeek(){
  const strip=document.getElementById('weekStrip');strip.innerHTML='';
  const names=['Su','Mo','Tu','We','Th','Fr','Sa'],now=new Date();
  for(let i=6;i>=0;i--){
    const d=new Date(now);d.setDate(now.getDate()-i);
    const k=d.toISOString().slice(0,10),isT=i===0,done=(S.completions[k]||[]).length,total=S.habits.length,pct=total>0?Math.round(done/total*100):0;
    const col=mk('div','week-col'),nm=mk('div','week-name'),pip=mk('div','week-pip'),sub=mk('div','week-sub');
    nm.textContent=names[d.getDay()]; pip.textContent=d.getDate();
    if(isT)pip.classList.add('today'); else if(pct===100&&total>0)pip.classList.add('full'); else if(pct>0)pip.classList.add('partial');
    sub.textContent=total>0&&!isT?pct+'%':isT?'‚Üë':'';
    col.append(nm,pip,sub);strip.appendChild(col);
  }
}

/* ‚îÄ‚îÄ HABITS ‚îÄ‚îÄ */
function renderHabits(){
  const list=document.getElementById('habitsList');
  if(!S.habits.length){list.innerHTML=`<div class="empty-state"><span class="empty-icon">üå±</span><div class="empty-head">No habits yet</div><div class="empty-body">Tap <strong>+ Add New</strong> above to create your first habit and start building momentum.</div></div>`;return;}
  const tk=todayKey(),doneIds=S.completions[tk]||[];
  list.innerHTML='';
  S.habits.forEach((h,idx)=>{
    const isDone=doneIds.includes(h.id),streak=habitStreak(h.id),rate=habitRate(h.id);
    const card=mk('div','habit-card'+(isDone?' done':''));
    card.style.animationDelay=(idx*.05)+'s';
    const accent=mk('div','habit-accent');accent.style.background=h.color;
    const inner=mk('div','habit-inner');
    const iconBox=mk('div','habit-icon-box');iconBox.textContent=h.icon;iconBox.title='View details';
    const body=mk('div','habit-body');
    const name=mk('div','habit-name');name.textContent=h.name;
    const meta=mk('div','habit-meta');
    const stag=mk('div','habit-stag');stag.textContent='üî• '+streak+'d';
    const bar=mk('div','habit-bar'),barF=mk('div','habit-bar-fill');
    barF.style.width=rate+'%';barF.style.background=h.color;bar.appendChild(barF);
    const pct=mk('div','habit-pct');pct.textContent=rate+'%';
    meta.append(stag,bar,pct);body.append(name,meta);
    const chk=mk('div','habit-check');chk.textContent=isDone?'‚úì':'';
    // click icon ‚Üí detail
    iconBox.addEventListener('click',e=>{e.stopPropagation();openDetail(h.id);});
    // click check ‚Üí toggle
    chk.addEventListener('click',e=>{e.stopPropagation();toggleHabit(h.id);});
    // click card ‚Üí toggle
    inner.addEventListener('click',e=>{if(!e.target.closest('.habit-icon-box'))toggleHabit(h.id);});
    inner.append(iconBox,body,chk);card.append(accent,inner);list.appendChild(card);
  });
}

function toggleHabit(id){
  const tk=todayKey();
  if(!S.completions[tk])S.completions[tk]=[];
  const arr=S.completions[tk],i=arr.indexOf(id);
  if(i===-1){arr.push(id);S.totalWins++;const h=S.habits.find(x=>x.id===id);toast(`${h?.icon||'‚úÖ'} Done!`);}
  else{arr.splice(i,1);S.totalWins=Math.max(0,S.totalWins-1);}
  save();renderHabits();refreshHero();buildWeek();
  if((S.completions[tk]||[]).length===S.habits.length&&S.habits.length>0&&S.settings?.celebrate!==false)setTimeout(()=>toast('üéâ Perfect day! Every habit done!'),700);
}

/* ‚îÄ‚îÄ CREATE ‚îÄ‚îÄ */
function buildEmojiGrid(){
  const g=document.getElementById('emojiGrid');g.innerHTML='';
  EMOJIS.forEach((em,i)=>{const d=mk('div','eg-item'+(i===0?' sel':''));d.textContent=em;d.onclick=()=>{g.querySelectorAll('.eg-item').forEach(x=>x.classList.remove('sel'));d.classList.add('sel');};g.appendChild(d);});
}
function buildColorRow(){
  const r=document.getElementById('colorRow');r.innerHTML='';
  COLORS.forEach((c,i)=>{const d=mk('div','cr-item'+(i===0?' sel':''));d.style.background=c;d.onclick=()=>{r.querySelectorAll('.cr-item').forEach(x=>x.classList.remove('sel'));d.classList.add('sel');};r.appendChild(d);});
}
function createHabit(){
  const name=document.getElementById('newHabitName').value.trim();
  if(!name){toast('‚ö†Ô∏è Enter a habit name!');return;}
  const icon=document.querySelector('#emojiGrid .sel')?.textContent||'‚≠ê';
  const color=document.querySelector('#colorRow .sel')?.style.background||COLORS[0];
  S.habits.push({id:Date.now().toString(),name,icon,color,createdAt:todayKey()});
  save();document.getElementById('newHabitName').value='';
  buildEmojiGrid();buildColorRow();closeModal('addModal');
  renderHabits();refreshHero();buildWeek();toast(`${icon} Habit created!`);
}

/* ‚îÄ‚îÄ DETAIL ‚îÄ‚îÄ */
function openDetail(id){
  const h=S.habits.find(x=>x.id===id);if(!h)return;
  const streak=habitStreak(id),rate=habitRate(id),total=Object.values(S.completions).filter(a=>a.includes(id)).length;
  const now=new Date();let calHtml='';
  for(let i=27;i>=0;i--){const d=new Date(now);d.setDate(now.getDate()-i);const k=d.toISOString().slice(0,10);const done=(S.completions[k]||[]).includes(id);const isT=i===0;calHtml+=`<div class="mc${done?' d':''}${isT&&!done?' t':''}">${d.getDate()}</div>`;}
  document.getElementById('detailBody').innerHTML=`
    <div class="detail-hero">
      <div class="detail-icon-wrap" style="background:${h.color}18;border:1.5px solid ${h.color}30">${h.icon}</div>
      <div><div class="detail-name">${h.name}</div><div class="detail-since">Since ${h.createdAt||'day one'}</div></div>
    </div>
    <div class="detail-stats">
      <div class="ds-cell"><div class="ds-val" style="color:${h.color}">${streak}</div><div class="ds-lbl">üî• Streak</div></div>
      <div class="ds-cell"><div class="ds-val" style="color:var(--gold)">${total}</div><div class="ds-lbl">‚≠ê Total</div></div>
      <div class="ds-cell"><div class="ds-val" style="color:var(--grn)">${rate}%</div><div class="ds-lbl">üìà Rate</div></div>
    </div>
    <div class="mini-cal-head">Last 28 days</div>
    <div class="mini-cal">${calHtml}</div>
    <button class="del-btn" id="delBtn">Remove this habit</button>`;
  document.getElementById('delBtn').onclick=()=>{closeModal('detailModal');showConfirm('üóëÔ∏è',`Remove "${h.name}"?`,'This will delete the habit and all its history. This cannot be undone.',()=>{S.habits=S.habits.filter(x=>x.id!==id);Object.keys(S.completions).forEach(k=>{S.completions[k]=(S.completions[k]||[]).filter(x=>x!==id);});save();renderHabits();refreshHero();buildWeek();toast('üóëÔ∏è Habit removed');});};
  openModal('detailModal');
}

/* ‚îÄ‚îÄ STATS ‚îÄ‚îÄ */
function renderStats(){
  recalcMeta();
  document.getElementById('st-streak').textContent=S.streak||0;
  document.getElementById('st-total').textContent=S.totalWins||0;
  document.getElementById('st-perfect').textContent=S.perfectDays||0;
  const now=new Date();let possible=0,done=0;
  for(let i=0;i<30;i++){const d=new Date(now);d.setDate(now.getDate()-i);const k=d.toISOString().slice(0,10);possible+=S.habits.length;done+=(S.completions[k]||[]).length;}
  document.getElementById('st-rate').textContent=(possible>0?Math.round(done/possible*100):0)+'%';
  const container=document.getElementById('habitsBreakdown');
  if(!S.habits.length){container.innerHTML=`<div class="empty-state" style="padding:30px 20px"><span class="empty-icon">üìä</span><div class="empty-head">No habits yet</div><div class="empty-body">Add habits to see your breakdown.</div></div>`;return;}
  container.innerHTML='';
  S.habits.forEach(h=>{
    const streak=habitStreak(h.id),rate=habitRate(h.id),total=Object.values(S.completions).filter(a=>a.includes(h.id)).length;
    let bars='';
    for(let i=13;i>=0;i--){const d=new Date(now);d.setDate(now.getDate()-i);const k=d.toISOString().slice(0,10);const dn=(S.completions[k]||[]).includes(h.id);bars+=`<div class="bc-bar" style="background:${h.color};height:${dn?100:14}%;opacity:${dn?1:.18};transition:height .5s ${i*.03}s"></div>`;}
    const card=mk('div','breakdown-card');
    card.innerHTML=`<div class="bc-header"><div class="bc-icon">${h.icon}</div><div class="bc-name">${h.name}</div><div class="bc-streak" style="color:${h.color}">üî•${streak}d</div></div><div class="bc-bars">${bars}</div><div class="bc-footer"><div class="bc-stat"><div class="bc-stat-val" style="color:${h.color}">${rate}%</div><div class="bc-stat-lbl">30d Rate</div></div><div class="bc-stat"><div class="bc-stat-val" style="color:var(--gold)">${total}</div><div class="bc-stat-lbl">Total</div></div><div class="bc-stat"><div class="bc-stat-val" style="color:var(--grn)">${streak}</div><div class="bc-stat-lbl">Streak</div></div></div>`;
    container.appendChild(card);
  });
}

/* ‚îÄ‚îÄ HISTORY ‚îÄ‚îÄ */
function renderHistory(){
  const container=document.getElementById('calContainer');container.innerHTML='';
  const months=['January','February','March','April','May','June','July','August','September','October','November','December'];
  const now=new Date(),todayStr=todayKey();
  for(let m=0;m<=2;m++){
    const target=new Date(now.getFullYear(),now.getMonth()-m,1);
    const yr=target.getFullYear(),mon=target.getMonth();
    const hdr=mk('div','month-hdr');hdr.textContent=months[mon]+' '+yr;
    const grid=mk('div','cal-grid');
    ['Su','Mo','Tu','We','Th','Fr','Sa'].forEach(n=>{const d=mk('div','cal-dn');d.textContent=n;grid.appendChild(d);});
    const firstDay=new Date(yr,mon,1).getDay();
    for(let b=0;b<firstDay;b++)grid.appendChild(mk('div','cal-d emp'));
    const daysInMonth=new Date(yr,mon+1,0).getDate();
    for(let day=1;day<=daysInMonth;day++){
      const ds=`${yr}-${String(mon+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
      const done=(S.completions[ds]||[]).length,total=S.habits.length,cell=mk('div','cal-d');
      cell.textContent=day;
      if(ds===todayStr)cell.classList.add('today');
      else if(done===total&&total>0)cell.classList.add('perfect');
      else if(done>0)cell.classList.add('partial');
      grid.appendChild(cell);
    }
    container.append(hdr,grid);
  }
}

/* ‚îÄ‚îÄ SETTINGS ‚îÄ‚îÄ */
function renderSettings(){
  recalcMeta();
  const n=S.userName||'';
  document.getElementById('profileName').textContent=n||'Habit Builder';
  document.getElementById('nameDisplay').textContent=n||'Tap to set your name';
  document.getElementById('profileTagline').textContent=S.streak>0?`${S.streak} day streak üî•`:'Start your journey today';
  const rt=document.getElementById('toggle-remind'),ct=document.getElementById('toggle-celebrate');
  if(S.settings?.remind)rt.classList.add('on');else rt.classList.remove('on');
  if(S.settings?.celebrate!==false)ct.classList.add('on');else ct.classList.remove('on');
}
function saveName(){const n=document.getElementById('nameInput').value.trim();if(!n){toast('‚ö†Ô∏è Enter your name!');return;}S.userName=n;save();closeModal('nameModal');renderSettings();toast('‚úÖ Name saved!');}

/* ‚îÄ‚îÄ DATA ‚îÄ‚îÄ */
function exportData(){
  const blob=new Blob([JSON.stringify(S,null,2)],{type:'application/json'});
  const url=URL.createObjectURL(blob),a=document.createElement('a');
  a.href=url;a.download=`streak-data-${todayKey()}.json`;a.click();URL.revokeObjectURL(url);toast('üì§ Data exported!');
}
function shareStats(){
  recalcMeta();
  const text=`üî• My Streak Stats:\n‚Ä¢ ${S.streak} day streak\n‚Ä¢ ${S.totalWins} total completions\n‚Ä¢ ${S.perfectDays} perfect days\n‚Ä¢ ${S.habits.length} habits tracked\n\nüí™ Building better habits daily!`;
  if(navigator.clipboard){navigator.clipboard.writeText(text).then(()=>toast('üìã Copied to clipboard!'));}else{toast('üìä '+S.streak+' day streak!');}
}
function confirmReset(){
  showConfirm('‚ö†Ô∏è','Reset Everything?','This will delete ALL habits, streaks, and history permanently.',()=>{
    S={habits:[],completions:{},journal:{},totalWins:0,streak:0,perfectDays:0,userName:'',settings:{remind:false,celebrate:true}};
    save();document.querySelectorAll('.nav-tab').forEach(t=>t.classList.remove('active'));document.querySelector('[data-v="view-home"]').classList.add('active');
    document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));document.getElementById('view-home').classList.add('active');
    renderHabits();refreshHero();buildWeek();toast('üîÑ All data reset');
  });
}

/* ‚îÄ‚îÄ CONFIRM HELPER ‚îÄ‚îÄ */
function showConfirm(icon,title,msg,onOk){
  document.getElementById('confirmBody').innerHTML=`<span class="confirm-icon">${icon}</span><div class="confirm-title">${title}</div><div class="confirm-msg">${msg}</div><div class="confirm-btns"><button class="confirm-cancel" id="ccBtn">Cancel</button><button class="confirm-ok" id="coBtn">Confirm</button></div>`;
  document.getElementById('ccBtn').onclick=()=>closeModal('confirmModal');
  document.getElementById('coBtn').onclick=()=>{closeModal('confirmModal');onOk();};
  openModal('confirmModal');
}

/* ‚îÄ‚îÄ JOURNAL ‚îÄ‚îÄ */
function loadJournal(){document.getElementById('journalArea').value=S.journal[todayKey()]||'';}

/* ‚îÄ‚îÄ CALCS ‚îÄ‚îÄ */
function habitStreak(id){let s=0;const now=new Date();for(let i=0;i<365;i++){const d=new Date(now);d.setDate(now.getDate()-i);const k=d.toISOString().slice(0,10);if((S.completions[k]||[]).includes(id))s++;else if(i>0)break;}return s;}
function habitRate(id){let t=0,d=0;const now=new Date();for(let i=0;i<30;i++){const dt=new Date(now);dt.setDate(now.getDate()-i);const k=dt.toISOString().slice(0,10);t++;if((S.completions[k]||[]).includes(id))d++;}return t>0?Math.round(d/t*100):0;}

/* ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ */
function openModal(id){document.getElementById(id).classList.add('open');document.body.style.overflow='hidden';}
function closeModal(id){document.getElementById(id).classList.remove('open');document.body.style.overflow='';}

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
let tt;function toast(msg){const t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');clearTimeout(tt);tt=setTimeout(()=>t.classList.remove('show'),2800);}

init();
</script>
</body>
</html>
